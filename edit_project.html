<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Edit Project - Arkara</title>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    .container-wrapper {
      display: flex;
      gap: 20px;
      height: calc(100vh - 40px);
    }

    .card {
      flex: 1;
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      overflow-y: auto;
    }

    .card h1, .card h2 {
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 20px;
      font-weight: 700;
    }

    label {
      display: block;
      font-weight: 600;
      margin-top: 15px;
    }

    input, select, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-top: 10px;
      font-size: 14px;
      box-sizing: border-box;
    }

    .btn-group {
      margin-top: 15px;
      display: flex;
      gap: 10px;
    }

    button {
      background: linear-gradient(90deg, #7ac142, #a5d86f);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      cursor: pointer;
      font-weight: 600;
    }

    .btn-back {
      background: #ccc;
      color: #333;
    }

    .add-button {
      background: #8dd15c;
      padding: 7px 15px;
      border-radius: 6px;
      cursor: pointer;
      border: none;
      margin-top: 15px;
      margin-bottom : 15px;
      font-weight: 600;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    table thead th {
      background: #e0e0e0;
      border: 1px solid #ccc;
      padding: 8px;
      font-size: 12px;
    }

    table tbody td {
      padding: 8px;
      border: 1px solid #eee;
      font-size: 12px;
      background: none !important; /* Hilangkan pewarnaan latar belakang dari TD */
    }
    
    /* Gaya untuk hover pada baris tabel */
    table tbody tr:hover {
      background-color: #f0f0f0 !important; /* Warna latar belakang saat hover */
      cursor: pointer; 
    }

    /* Tambahan Styling untuk Dropdown Status */
    table tbody td select.status-select {
      width: 90%; 
      padding: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 11px;
      box-sizing: border-box;
    }
    
    /* Gaya untuk tombol hapus */
    .delete-button {
      background: none;
      border: none;
      color: #ff4d4d; 
      font-size: 16px;
      cursor: pointer;
      padding: 0 5px;
      opacity: 0.7; 
      transition: opacity 0.2s ease-in-out;
    }

    .delete-button:hover {
      opacity: 1; 
      color: #ff0000;
    }

    /* Penyesuaian lebar & alignment kolom status dan aksi */
    table thead th:nth-child(5), /* Kolom Status */
    table thead th:nth-child(6) { /* Kolom Aksi */
        width: 100px; 
    }

    table tbody td:nth-child(5),
    table tbody td:nth-child(6) {
        text-align: center; /* Pusatkan konten */
    }


    /* Terapkan pewarnaan latar belakang ke TR (baris) */
    .status-row.status-Proposed { background:#fff9e6; }
    .status-row.status-Approved { background:#e6ffe6; }
    .status-row.status-Pending  { background:#fff0e6; }
    .status-row.status-Cancel   { background:#ffe6e6; }
    
    @media (max-width: 900px) {
      .container-wrapper {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>

  <div class="container-wrapper">

    <div class="card">

      <h1>Update Data</h1>

      <form id="editForm">
        
        <label>Tanggal</label>
        <input type="date" id="start_date">

        <label>Lokasi</label>
        <input type="text" id="lokasi" list="sugestiLokasi" oninput="fetchSuggestions()">
        <datalist id="sugestiLokasi"></datalist>
        
        <label>Prospek</label>
        <input type="text" id="perusahaan">

        <label>Sektor</label>
        <input type="text" id="sektor">

        <label>Tipe</label>
        <select id="tipe">
          <option>Joint Venture</option>
          <option>Take Over</option>
          <option>Partnership</option>
        </select>

        <label>Dokumen Update</label>
        <select id="dokumen_update">
          <option>Ada</option>
          <option>Belum</option>
        </select>

        <label>Dokumen Status</label>
        <select id="dokumen_status">
          <option>Approved</option>
          <option>Pending</option>
          <option>On Progress</option>
          <option>Completed</option>
        </select>

        <label>Notes / Next Action</label>
        <textarea id="notes" rows="3"></textarea>

        <div class="btn-group">
          <button type="button" onclick="saveData()">üíæ Simpan</button>
          <button type="button" class="btn-back" onclick="window.history.back()">‚Üê Kembali</button>
        </div>

      </form>
    </div>

    <div class="card">

      <h1>Upload Dokumen</h1>

      <label>Judul</label>
      <input type="text" id="documentTitleInput">

      <label>Pilih File</label>
      <input type="file" id="documentFileInput">

      <button class="add-button" onclick="addNewDocument()">Upload</button>

      <h2>Historical</h2>

      <table>
        <thead>
          <tr>
            <th>Tanggal</th>
            <th>Judul</th>
            <th>Jenis</th>
            <th>Link</th>
            <th>Status</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="documentHistoryTable"></tbody>
      </table>

    </div>

  </div>

<script>
  // Data Mock-up
  const projects = [
    { 
      no:1, 
      lokasi:"Jakarta", 
      perusahaan:"PT Alpha", 
      sektor:"Property",
      tipe:"Joint Venture",
      start:"2025-01-05", // Ini adalah format YYYY-MM-DD
      upload:"Ada",
      status:"Approved",
      notes:"Survey lokasi"
    }
  ];

  const documentHistory = {
    1: [
      { id:101, date:"2025-01-10", title:"MoU Awal", type:"PDF", link:"#", status:"Approved" },
      { id:102, date:"2025-02-01", title:"Dokumen Legalitas", type:"DOCX", link:"#", status:"Pending" },
    ]
  };

  const params = new URLSearchParams(window.location.search);
  const id = parseInt(params.get("id"));
  const project = projects.find(p => p.no === id);

  function loadProject() {
    if (!project) return;

    document.getElementById("perusahaan").value = project.perusahaan;
    document.getElementById("lokasi").value = project.lokasi;
    document.getElementById("sektor").value = project.sektor;
    document.getElementById("tipe").value = project.tipe;
    document.getElementById("start_date").value = project.start;
    document.getElementById("dokumen_update").value = project.upload;
    document.getElementById("dokumen_status").value = project.status;
    document.getElementById("notes").value = project.notes;

    renderHistory();
  }

  // --- FUNGSI FORMAT TANGGAL DIUBAH KEMBALI KE DD / MM / YYYY ---
  function formatDate(dateString) {
    if (!dateString) return '';
    // Asumsi dateString adalah YYYY-MM-DD
    const parts = dateString.split('-');
    if (parts.length === 3) {
        // parts[2] = DD, parts[1] = MM, parts[0] = YYYY
        return `${parts[2]} / ${parts[1]} / ${parts[0]}`;
    }
    return dateString; // Fallback jika format tidak sesuai
  }
  // --------------------------------------------------------

  // --- FUNGSI NOMINATIM ---
  function fetchSuggestions() {
    const inputElement = document.getElementById("lokasi");
    const dataListElement = document.getElementById("sugestiLokasi");
    const query = inputElement.value.trim();

    dataListElement.innerHTML = '';

    if (query.length < 3) {
      return;
    }

    const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query)}&format=json&addressdetails=1&limit=5`;

    fetch(url)
      .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        data.forEach(item => {
          const option = document.createElement('option');
          option.value = item.display_name;
          dataListElement.appendChild(option);
        });
      })
      .catch(error => {
        console.error("Error fetching location suggestions from Nominatim:", error);
      });
  }
  
  // --- FUNGSI RENDER HISTORY ---
  function renderHistory() {
    const tbody = document.getElementById("documentHistoryTable");
    tbody.innerHTML = "";
    const statusOptions = ["Proposed", "Approved", "Pending", "Cancel"]; 

    (documentHistory[id] || []).forEach(doc => {
      const selectHtml = `
        <select 
          class="status-select" 
          data-doc-id="${doc.id}" 
          onchange="updateDocumentStatus(this.value, ${doc.id})"
        >
          ${statusOptions.map(option => `
            <option 
              value="${option}" 
              ${doc.status === option ? 'selected' : ''}
            >
              ${option}
            </option>
          `).join('')}
        </select>
      `;

      tbody.innerHTML += `
        <tr class="status-row status-${doc.status}">
          <td>${formatDate(doc.date)}</td> <td>${doc.title}</td>
          <td>${doc.type}</td>
          <td><a href="${doc.link}" target="_blank">Lihat</a></td>
          <td>${selectHtml}</td>
          <td>
            <button class="delete-button" onclick="deleteDocument(${doc.id})">üóëÔ∏è</button>
          </td>
        </tr>
      `;
    });
  }

  // --- FUNGSI UPDATE STATUS DOKUMEN ---
  function updateDocumentStatus(newStatus, docId) {
    const history = documentHistory[id];
    const doc = history.find(d => d.id === docId);

    if (doc) {
      doc.status = newStatus;
      
      const row = document.querySelector(`select[data-doc-id="${docId}"]`).closest('tr');
      if (row) {
          row.className = row.className.split(' ').filter(c => !c.startsWith('status-')).join(' ');
          row.classList.add(`status-row`);
          row.classList.add(`status-${newStatus}`);
      }
      console.log(`Dokumen ID ${docId} diperbarui ke status: ${newStatus}`);
    }
  }
  
  // --- FUNGSI MENGHAPUS DOKUMEN ---
  function deleteDocument(docId) {
    if (!confirm("Anda yakin ingin menghapus dokumen ini?")) {
      return; 
    }

    let history = documentHistory[id];
    const initialLength = history.length;
    
    documentHistory[id] = history.filter(doc => doc.id !== docId);

    if (documentHistory[id].length < initialLength) {
        alert("Dokumen berhasil dihapus.");
        renderHistory(); 
    } else {
        alert("Dokumen tidak ditemukan atau gagal dihapus.");
    }
  }

  function addNewDocument() {
    const title = document.getElementById("documentTitleInput").value.trim();
    const file = document.getElementById("documentFileInput").files[0];

    if (!title) return alert("Judul wajib diisi.");
    if (!file) return alert("File wajib diupload.");

    const ext = file.name.split('.').pop().toUpperCase();
    const today = new Date().toISOString().slice(0,10);

    const newDoc = {
      id: Date.now(),
      date: today,
      title,
      type: ext,
      link: "#",
      status: "Proposed"
    };

    if (!documentHistory[id]) {
      documentHistory[id] = [];
    }
    
    documentHistory[id].push(newDoc);
    renderHistory();

    // Reset input
    document.getElementById("documentTitleInput").value = '';
    document.getElementById("documentFileInput").value = '';
    alert("Dokumen berhasil ditambahkan dengan status Proposed.");
  }

  function saveData() {
    alert("Data proyek tersimpan (simulasi).");
  }

  loadProject();
</script>

</body>
</html>